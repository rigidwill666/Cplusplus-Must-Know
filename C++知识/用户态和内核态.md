在计算机操作系统中，用户态（User Mode）和内核态（Kernel Mode）是两种不同的执行模式，它们分别代表着程序执行的不同权限级别和访问能力。
# 基本概念
## 用户态
用户态是指应用程序运行时的基本执行模式。在用户态下，程序只能访问其自身的资源（如内存、文件等），不能直接访问操作系统的内核资源。
特点：
- 无法直接操作硬件或核心系统资源。
- 当程序需要操作硬件或进行系统级的操作（如文件读写、网络操作等）时，*必须通过系统调用进入内核态*。
- 每个用户进程运行在独立的**虚拟地址**空间中。如果在用户态中发生错误（如除零、访问非法内存等），操作系统会干预并终止该程序。
## 内核态
内核态是操作系统内核运行的模式，系统中的所有核心功能（如硬件驱动、内存管理、进程调度等）都运行在这个模式下。在内核态中，程序拥有更高的权限，可以直接访问硬件和系统资源。
特点：
- 可以直接操作硬件（如 CPU、内存、I/O 设备）和所有系统资源，*可直接返回用户态*。
- 内核态程序执行时，操作系统的核心模块负责管理系统资源，确保操作系统的稳定性和安全性。
- 内核代码运行在统一的**内核地址**空间，直接访问**物理内存**。如果内核态代码出现错误，可能会导致系统崩溃或不可恢复的错误。
# 切换
当程序需要访问硬件或执行系统调用时，操作系统会通过**上下文切换**将程序从用户态切换到内核态。这个过程会保存当前程序的状态（如寄存器值），然后进入内核态执行需要的操作，最后再切换回用户态继续执行原程序。
系统调用示例：
用户程序在用户态中调用 read() 系统调用来读取文件数据；操作系统切换到内核态，内核从磁盘读取文件数据；操作系统将文件数据传回用户态，程序继续执行。
> 上下文切换？：
> 指操作系统在多任务处理过程中，将一个正在运行的进程或线程的执行状态保存起来，然后恢复另一个进程或线程的执行状态，从而实现不同进程或线程之间的切换。上下文切换是操作系统支持**多任务并发执行**的重要机制。过多的上下文切换会导致性能下降。因此，操作系统通常会采用一些策略来优化上下文切换的频率，例如：时间片轮转调度和优先级调度。
>
> 具体过程：保存当前进程的上下文（包括程序计数器、CPU 寄存器的内容、内存管理信息）；加载下一个进程的上下文；切换到新进程（不同进程需要切换内存地址空间）。
